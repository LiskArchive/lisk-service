= Configuration with PM2
Mona Bärenfänger <mona@lightcurve.io>
:description: Describes how to configure Lisk Service with PM2.
:toc:
:imagesdir: ../assets/images
:page-previous: /lisk-service/setup/source.html
:page-previous-title: Installation from source code
:page-next: /lisk-service/management/source.html
:page-next-title: PM2 commands

:url_pm2: https://pm2.keymetrics.io/
:url_pm2_ecosystem_file: https://pm2.keymetrics.io/docs/usage/application-declaration/

:url_management_pm2: management/source.adoc
:url_references_config: configuration/index.adoc

// The following Default section commented out below has now been updated with the latest values for later use.
// == Default configuration

// The {url_pm2_ecosystem_file}[PM2 ecosystem file^] provides the possibility to configure behavior, options, environment variables, and the log files of Lisk Service with PM2.
// The default configuration file is `ecosystem.core3.config.js`, and is located in the root folder of `lisk-service`:
// It contains a configuration to connect to a local Lisk Core node.

// This config will be used by default when starting Lisk Service with the following:

// [source,bash]
// ----
// pm2 start ecosystem.core3.config.js
// ----
//
// .Contents of `ecosystem.core3.config.js`
// [source,javascript]
// ----
// module.exports = {
// 	apps: [
// 		{
// 			name: 'lisk-service-gateway',
// 			script: 'app.js',
// 			cwd: './services/gateway',
// 			pid_file: './pids/service_gateway.pid',
// 			out_file: './logs/service_gateway.log',
// 			error_file: './logs/service_gateway.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '300M',
// 			autorestart: true,
// 			env: {
// 				PORT: '9901',
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_GATEWAY_REDIS_VOLATILE: 'redis://localhost:6379/5',
// 				ENABLE_HTTP_API: 'http-status,http-version3,http-exports',
// 				ENABLE_WS_API: 'blockchain,rpc-v3',
// 				GATEWAY_DEPENDENCIES: 'indexer,connector',
// 				WS_RATE_LIMIT_ENABLE: 'false',
// 				WS_RATE_LIMIT_CONNECTIONS: 5,
// 				WS_RATE_LIMIT_DURATION: 1, // in seconds
// 				ENABLE_REQUEST_CACHING: 'true',
// 				JSON_RPC_STRICT_MODE: 'false',
// 				HTTP_RATE_LIMIT_ENABLE: 'false',
// 				HTTP_RATE_LIMIT_CONNECTIONS: 200,
// 				HTTP_RATE_LIMIT_WINDOW: 10, // in seconds
// 				HTTP_CACHE_CONTROL_DIRECTIVES: 'public, max-age=10',
// 				ENABLE_HTTP_CACHE_CONTROL: 'true',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-blockchain-app-registry',
// 			script: 'app.js',
// 			cwd: './services/blockchain-app-registry',
// 			pid_file: './pids/service_blockchain_app_registry.pid',
// 			out_file: './logs/service_blockchain_app_registry.log',
// 			error_file: './logs/service_blockchain_app_registry.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '150M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_APP_REGISTRY_MYSQL: 'mysql://lisk:password@localhost:3306/lisk',
// 				ENABLE_REBUILD_INDEX_AT_INIT: 'false',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-blockchain-connector',
// 			script: 'app.js',
// 			cwd: './services/blockchain-connector',
// 			pid_file: './pids/service_blockchain_connector.pid',
// 			out_file: './logs/service_blockchain_connector.log',
// 			error_file: './logs/service_blockchain_connector.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '150M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				LISK_APP_WS: 'ws://localhost:7887',
// 				GEOIP_JSON: 'https://geoip.lisk.com/json',
// 				// USE_LISK_IPC_CLIENT: 'true',
// 				// LISK_APP_DATA_PATH: '~/.lisk/lisk-core',
// 				// ENABLE_TESTING_MODE: 'false',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-blockchain-indexer',
// 			script: 'app.js',
// 			cwd: './services/blockchain-indexer',
// 			pid_file: './pids/service_blockchain_indexer.pid',
// 			out_file: './logs/service_blockchain_indexer.log',
// 			error_file: './logs/service_blockchain_indexer.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '500M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_INDEXER_CACHE_REDIS: 'redis://localhost:6379/1',
// 				SERVICE_INDEXER_REDIS_VOLATILE: 'redis://localhost:6379/2',
// 				SERVICE_MESSAGE_QUEUE_REDIS: 'redis://localhost:6379/3',
// 				SERVICE_INDEXER_MYSQL: 'mysql://lisk:password@localhost:3306/lisk',
// 				ENABLE_DATA_RETRIEVAL_MODE: 'true',
// 				ENABLE_INDEXING_MODE: 'true',
// 				ENABLE_PERSIST_EVENTS: 'false',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-blockchain-coordinator',
// 			script: 'app.js',
// 			cwd: './services/blockchain-coordinator',
// 			pid_file: './pids/service_blockchain_coordinator.pid',
// 			out_file: './logs/service_blockchain_coordinator.log',
// 			error_file: './logs/service_blockchain_coordinator.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '300M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_MESSAGE_QUEUE_REDIS: 'redis://localhost:6379/3',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-fee-estimator',
// 			script: 'app.js',
// 			cwd: './services/fee-estimator',
// 			pid_file: './pids/service_fee_estimator.pid',
// 			out_file: './logs/service_fee_estimator.log',
// 			error_file: './logs/service_fee_estimator.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '300M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_FEE_ESTIMATOR_CACHE: 'redis://localhost:6379/1',
// 				ENABLE_FEE_ESTIMATOR_QUICK: 'true',
// 				ENABLE_FEE_ESTIMATOR_FULL: 'false',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-transaction-statistics',
// 			script: 'app.js',
// 			cwd: './services/transaction-statistics',
// 			pid_file: './pids/service_transaction_statistics.pid',
// 			out_file: './logs/service_transaction_statistics.log',
// 			error_file: './logs/service_transaction_statistics.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '300M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_STATISTICS_REDIS: 'redis://localhost:6379/1',
// 				SERVICE_STATISTICS_MYSQL: 'mysql://lisk:password@localhost:3306/lisk',
// 				TRANSACTION_STATS_HISTORY_LENGTH_DAYS: '366',
// 			},
// 		},
// 		{
// 			name: 'lisk-service-market',
// 			script: 'app.js',
// 			cwd: './services/market',
// 			pid_file: './pids/service_market.pid',
// 			out_file: './logs/service_market.log',
// 			error_file: './logs/service_market.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '300M',
// 			autorestart: true,
// 			env: {
// 				// --- Remember to set the properties below
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_MARKET_REDIS: 'redis://localhost:6379/2',
// 				SERVICE_MARKET_FIAT_CURRENCIES: 'EUR,USD,CHF,GBP,RUB',
// 				SERVICE_MARKET_TARGET_PAIRS: 'LSK_BTC,LSK_EUR,LSK_USD,LSK_CHF,BTC_EUR,BTC_USD,BTC_CHF',
// 				// EXCHANGERATESAPI_IO_API_KEY: ''
// 			},
// 		},
// 		{
// 			name: 'lisk-service-export',
// 			script: 'app.js',
// 			cwd: './services/export',
// 			pid_file: './pids/service_export.pid',
// 			out_file: './logs/service_export.log',
// 			error_file: './logs/service_export.err',
// 			log_date_format: 'YYYY-MM-DD HH:mm:ss SSS',
// 			watch: false,
// 			kill_timeout: 10000,
// 			max_memory_restart: '300M',
// 			autorestart: true,
// 			env: {
// 				SERVICE_BROKER: 'redis://localhost:6379/0',
// 				SERVICE_EXPORT_REDIS: 'redis://localhost:6379/3',
// 				SERVICE_EXPORT_REDIS_VOLATILE: 'redis://localhost:6379/4',
// 			},
// 		},
// 	],
// };
// ----

== Custom configuration

To create a custom configuration, it is recommended to copy the default configuration.

[source,bash]
----
cp ecosystem.config.js ecosystem.custom.config.js
----
// #<1>
// <1> Copies the file `ecosystem.core3.config.js` and renames it to `ecosystem.custom.config.js`.

Now it is possible to open the new file `ecosystem.custom.config.js` and adjust it as desired.

Lisk Service can be configured in various ways by setting environment variables.

TIP: All available configuration options are described in the xref:{url_references_config}[Configuration reference].

To start Lisk Service with the custom ecosystem file, execute the following command:

[source,bash]
----
pm2 start ecosystem.custom.config.js
----

Finally, if you want to use `npm start` and `npm stop` to start and stop Lisk Service with the custom configuration, don't forget to update the scripts in `package.json`:

[source,json]
----
{
  //[...]
  "scripts": {
    "start": "pm2 start ecosystem.custom.config.js",
    "stop": "pm2 delete ecosystem.custom.config.js",
  //[...]
  }
}
----

// (Contents in the linked PM2 commands page in this sentence will need updating) Additional commands for managing Lisk Service with PM2 are described on the xref:{url_management_pm2}[PM2 commands] page.
